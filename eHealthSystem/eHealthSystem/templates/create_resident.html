<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Resident</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
</head>
<body>
    <div class="container">
        <h2 class="mt-5">Create Resident</h2>
        <form method="POST" class="mt-3">
            {% csrf_token %}
            <div class="form-group">
                {{ form.name.label }} 
                {{ form.name }} 
            </div>
            <div class="form-group">
                {{ form.account_type.label }} 
                {{ form.account_type }} 
            </div>
            <div class="form-group">
                {{ form.block.label }} 
                {{ form.block }} 
            </div>
            <div class="form-group">
                {{ form.level.label }} 
                {{ form.level }} 
            </div>
            <div class="form-group">
                {{ form.room_number.label }} 
                {{ form.room_number }} 
            </div>

            <button type="submit" class="btn btn-success">Create Resident</button>
        </form>
        
        <a href="{% url 'home' %}" class="btn btn-secondary mt-3">Back to Home</a>
    </div>

    <script>
        // jQuery for dynamically updating room options based on selected block and level
        $(document).ready(function() {
            // Trigger room update when block or level is changed
            $('#id_block, #id_level').change(function() {
                var block = $('#id_block').val();
                var level = $('#id_level').val();

                // Only proceed if both block and level are selected
                if (block && level) {
                    $.ajax({
                        url: '{% url "get_rooms" %}',  // AJAX endpoint for getting rooms
                        data: {
                            'block': block,
                            'level': level
                        },
                        success: function(response) {
                            var roomSelect = $('#id_room_number');
                            roomSelect.empty();  // Clear current room options

                            // Add new room options from the response
                            if (response.rooms.length > 0) {
                                $.each(response.rooms, function(index, room) {
                                    roomSelect.append($('<option>', {
                                        value: room.id,
                                        text: room.room_number
                                    }));
                                });
                            } else {
                                roomSelect.append($('<option>', {
                                    value: '',
                                    text: 'No rooms available for this selection'
                                }));
                            }
                        },
                        error: function() {
                            alert("An error occurred while fetching rooms.");
                        }
                    });
                }
            });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
